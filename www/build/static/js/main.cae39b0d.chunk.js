(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{27:function(t,e,n){},61:function(t,e,n){},62:function(t,e,n){},81:function(t,e,n){},82:function(t,e,n){},83:function(t,e,n){},84:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n(3),i=n.n(a),o=n(28),c=n.n(o),s=(n(61),n(2)),l=n(4),u=n(8),d=n(7),h=(n(62),n(1)),f=n.n(h),p=n(5),b=n(9);function v(t,e,n){return t<e&&(t=e),t>n&&(t=n),t}var g={d3containerName:"g",svgBackgroundColor:"#1f1d2b",nodeSizeMin:20,nodeSizeMax:50,nodeSizeMultiplier:1,nodeSize:function(t,e,n){var r=v(t,1,t);return v(Math.sqrt(e*n)/r/3*g.nodeSizeMultiplier,g.nodeSizeMin,g.nodeSizeMax)},nodeColorBrightnessMin:20,nodeColorBrightnessMax:100,nodeColorBrightness:50,nodeColorHistoryMultiplier:40,nodeColor:function(t){var e=v(g.nodeColorBrightness,g.nodeColorBrightnessMin,g.nodeColorBrightnessMax),n=t.generation*g.nodeColorHistoryMultiplier,r=e+n,a=e+n;return r=v(r,0,255),a=v(r,0,255),r=r.toString(16),a=a.toString(16),0==t.generation?"#00ff33":"#".concat(r,"00").concat(a)},linkWidth:2,linkColor:"#555555",linkDistanceMin:50,linkDistanceMax:500,linkDistanceMultiplier:1,linkDistance:function(t,e,n){return v(g.nodeSize(t,e,n),g.linkDistanceMin,g.linkDistanceMax)},labelOffsetX:4,labelOffsetY:2,labelColor:"#ffffff",graphNeighbourCount:3,graphGenerationCount:3},k=g;var j=n(30),m=n.n(j).a.default,x="".concat("http://localhost",":").concat(1234);function O(t){return y.apply(this,arguments)}function y(){return(y=Object(p.a)(f.a.mark((function t(e){var n,r,a,i=arguments;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:5,r="/data/search/articles/bycontent",t.next=4,m.post("".concat(x).concat(r),{str:e,limit:n});case 4:return a=t.sent,t.abrupt("return",a.data);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(t){return N.apply(this,arguments)}function N(){return(N=Object(p.a)(f.a.mark((function t(e){var n,r,a,i=arguments;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:5,r="/data/search/articles/byneigh",t.next=4,m.post("".concat(x).concat(r),{id:e,limit:n});case 4:return a=t.sent,t.abrupt("return",a.data);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(t){return w.apply(this,arguments)}function w(){return(w=Object(p.a)(f.a.mark((function t(e){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"/data/search/html/byid",t.next=3,m.post("".concat(x).concat("/data/search/html/byid"),{id:e});case 3:return n=t.sent,t.abrupt("return",n.data);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function G(t){return M.apply(this,arguments)}function M(){return(M=Object(p.a)(f.a.mark((function t(e){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"/data/check/relsexist",t.next=3,m.post("".concat(x).concat("/data/check/relsexist"),{rels:e});case 3:return n=t.sent,t.abrupt("return",n.data);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(t){return I.apply(this,arguments)}function I(){return(I=Object(p.a)(f.a.mark((function t(e){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"/data/random/articles",t.next=3,m.post("".concat(x).concat("/data/random/articles"),{limit:e});case 3:return n=t.sent,t.abrupt("return",n.data);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var z=function t(e,n){Object(s.a)(this,t),this.id=e.id,this.title=e.title,this.html="",this.generation=0,this.preserved=n,this.x=k.graphWidth/2,this.y=k.graphHeight/2},B=function t(e,n){Object(s.a)(this,t),this.fromID=e,this.toID=n},V=function(){function t(){Object(s.a)(this,t),this.nodes={},this.edges=[]}return Object(l.a)(t,[{key:"formatD3Nodes",value:function(){return Object.values(this.nodes)}},{key:"formatD3Edges",value:function(){var t=this;return this.edges.map((function(e){return{source:t.nodes[e.fromID],target:t.nodes[e.toID]}}))}},{key:"preservedNodeChan",value:function(){return Object.values(this.nodes).filter((function(t){return t.preserved})).sort((function(t,e){return t.generation-e.generation}))}},{key:"trimGeneration",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object.values(this.nodes).forEach((function(n){n.generation++,0!=n.preserved&&1!=e||n.generation>k.graphGenerationCount&&delete t.nodes[n.id]})),this.edges=this.edges.filter((function(e){return void 0!=t.nodes[e.fromID]&&void 0!=t.nodes[e.toID]}))}},{key:"recalculateEdges",value:function(){var t=Object(p.a)(f.a.mark((function t(){var e,n,r,a,i,o=this;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(this.trimGeneration(),e=[],n=Object.keys(this.nodes),r=0;r<n.length;r++)for(a=0;a<n.length;a++)r!=a&&e.push([n[r],n[a]]);return t.next=6,G(e.map((function(t){return[o.nodes[t[0]].id,o.nodes[t[1]].id]})));case 6:i=t.sent,this.edges=e.filter((function(t,e){return i[e]})).map((function(t){return new B(t[0],t[1])}));case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"addInitialGenerationBySeedNode",value:function(){var t=Object(p.a)(f.a.mark((function t(e){var n,r,a=arguments;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(a.length>1&&void 0!==a[1])||a[1],(r={})[e.id]=e,1!=n){t.next=8;break}return t.next=6,C(e.id,k.graphNeighbourCount);case 6:t.sent.forEach((function(t){r[t.id]=new z(t,!1)}));case 8:return this.nodes=Object.assign(this.nodes,r),t.next=11,this.recalculateEdges();case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"addInitialGeneration",value:function(){var t=Object(p.a)(f.a.mark((function t(){var e,n,r,a,i,o=arguments;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.length>0&&void 0!==o[0]?o[0]:void 0,n=o.length>1&&void 0!==o[1]?o[1]:void 0,r=!(o.length>2&&void 0!==o[2])||o[2],void 0!=e||void 0!=n){t.next=9;break}return t.next=6,D(1);case 6:a=t.sent,e=a[0].id,n=a[0].title;case 9:return i=new z({id:e,title:n},!0),t.next=12,this.addInitialGenerationBySeedNode(i,r);case 12:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),t}(),F=function(){function t(e,n){var r=this;Object(s.a)(this,t),this.onNodeClick=function(t,e){r.containerCallbacks.callback.nodeClick(t,e),r.data.addInitialGenerationBySeedNode(e).then((function(t){r.setForceSimulation(),r.apply()}))},this.divID=e,this.data=new V,this.svg=null,this.forceSimulation=null,this.linkGroup=null,this.nodeGroup=null,this.setSVG(),this.setForceSimulation(),this.setLinkGroup(),this.setNodeGroup(),this.containerCallbacks=n}return Object(l.a)(t,[{key:"resetGraph",value:function(){var t=Object(p.a)(f.a.mark((function t(){var e=this;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.data.nodes={},this.data.edges=[],this.data.addInitialGeneration().then((function(t){e.setForceSimulation(),e.apply()}));case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"resetGraphUsingNode",value:function(){var t=Object(p.a)(f.a.mark((function t(e,n){var r=this;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.data.nodes={},this.data.edges=[],this.data.addInitialGeneration(e,n).then((function(t){r.setForceSimulation(),r.apply()}));case 3:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"setSVG",value:function(){var t=this;this.svg=function(t){var e=t.divID,n=t.resizeCallback,r=b.f(e).append("uiLayer"),a=r.append("svg");b.f(window).on("resize",(function(t){a.attr("width",.9*t.target.innerWidth),a.attr("height",.9*t.target.innerHeight),n()}));var i=b.g().scaleExtent([1,1]).on("zoom",(function(t){a.attr("transform",t.transform)}));return r.call(i),a}({divID:this.divID,resizeCallback:function(){t.setNodeGroup(),t.setForceSimulation(),t.apply()}})}},{key:"setForceSimulation",value:function(){var t=this.data.formatD3Nodes().length,e=this.svg.node().getBoundingClientRect().width,n=this.svg.node().getBoundingClientRect().height;this.forceSimulation=function(t){var e=t.forceCenterX,n=t.forceCenterY,r=t.collisionDistance,a=t.linkDistance;return b.e().force("charge",b.d()).force("center",b.a(e,n)).force("collide",b.b(r)).force("link",b.c().id((function(t){return t.id})).distance(a))}({forceCenterX:e/2,forceCenterY:n/2,collisionDistance:1.5*k.nodeSize(t,e,n),linkDistance:k.linkDistance(t,e,n)})}},{key:"setLinkGroup",value:function(){this.linkGroup=function(t){var e=t.svg,n=t.containerID,r=t.oldLinkGroup,a=t.edges,i=t.linkWidth,o=t.linkColor,c=e.append(n).attr("class","links").selectAll("line").data(a).enter().append("line").attr("stroke-width",i).attr("stroke",o);return null!=r&&c.enter().append(r),c}({svg:this.svg,containerID:k.d3containerName,oldLinkGroup:this.linkGroup,edges:this.data.formatD3Edges(),linkWidth:k.linkWidth,linkColor:k.linkColor})}},{key:"setNodeGroup",value:function(){var t=this.data.formatD3Nodes().length,e=this.svg.node().getBoundingClientRect().width,n=this.svg.node().getBoundingClientRect().height;this.nodeGroup=function(t){var e=t.svg,n=t.containerID,r=t.oldNodeGroup,a=t.nodes,i=t.nodeSize,o=t.nodeColorFunc,c=t.clickEvent,s=t.labelOffsetX,l=t.labelOffsetY,u=t.labelColor,d=t.linkGroup,h=e.append(n).attr("class","nodes").selectAll(n).data(a).enter().append(n).on("click",c).on("mouseover",(function(t,e){h.select("circle").attr("opacity",(function(t){return e.id==t.id?1:.2})),h.select("text").attr("opacity",(function(t){return e.id==t.id?1:.2})),d.style("opacity",(function(t,n){return t.source.id==e.id||t.target.id==e.id?1:0}))})).on("mouseout",(function(t,e){h.select("circle").attr("opacity",(function(t){return 1})),h.select("text").attr("opacity",u),d.style("opacity",(function(t){return 1}))}));return h.append("circle").attr("r",i).attr("fill",o),h.append("text").text((function(t){return t.title})).attr("x",s).attr("y",l).attr("stroke",u),null!=r&&h.enter().append(r),h}({svg:this.svg,containerID:k.d3containerName,oldNodeGroup:this.nodeGroup,nodes:this.data.formatD3Nodes(),nodeSize:k.nodeSize(t,e,n),nodeColorFunc:k.nodeColor,clickEvent:this.onNodeClick,labelOffsetX:k.labelOffsetX,labelOffsetY:k.labelOffsetY,labelColor:k.labelColor,linkGroup:this.linkGroup})}},{key:"apply",value:function(){this.svg.selectAll(k.d3containerName).remove(),this.setLinkGroup(),this.setNodeGroup(),function(t){var e=t.nodes,n=t.nodeGroup,r=t.edges,a=t.linkGroup,i=t.forceSimulation;i.nodes(e).on("tick",(function(){a.attr("x1",(function(t){return t.source.x})).attr("y1",(function(t){return t.source.y})).attr("x2",(function(t){return t.target.x})).attr("y2",(function(t){return t.target.y})),n.attr("transform",(function(t){return"translate(".concat(t.x,", ").concat(t.y,")")}))})),i.force("link").links(r)}({nodes:this.data.formatD3Nodes(),nodeGroup:this.nodeGroup,edges:this.data.formatD3Edges(),linkGroup:this.linkGroup,forceSimulation:this.forceSimulation})}}]),t}(),E=function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={d3state:null},t.containerCallbackOnNodeClick=function(e,n){var r=t.props.callbackManager.callbackFuncs("Graph","containerCallbackOnNodeClick");""==n.html?S(n.id).then((function(t){n.html=t,r.forEach((function(t){return t(n.html)}))})):r.forEach((function(t){return t(n.html)}))},t}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var t=new F("#graphbody",{callback:{nodeClick:this.containerCallbackOnNodeClick}});t.resetGraph(),this.setState({d3state:t}),window.dispatchEvent(new Event("resize")),this.props.callbackManager.registerObserver("SearchBar","done",this,"componentDidMount",(function(e){if(0!=e.length){var n=e[0];t.resetGraphUsingNode(n.id,n.title).then((function(t){return console.log(t)})).catch((function(t){return console.log(t)}))}}))}},{key:"render",value:function(){return Object(r.jsx)("div",{id:"graphbody"})}}]),n}(a.Component),L=(n(81),function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={content:""},t}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.props.callbackManager.registerObserver("Graph","containerCallbackOnNodeClick",this,"componentDidMount",(function(e){t.setState({content:e})}))}},{key:"render",value:function(){return Object(r.jsx)("div",{className:"article-wrapper",children:Object(r.jsx)("div",{className:"article-content",dangerouslySetInnerHTML:{__html:this.state.content}})})}}]),n}(a.Component)),A=(n(27),function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={loading:!1},t}return Object(l.a)(n,[{key:"render",value:function(){return Object(r.jsx)("div",{className:this.state.loading?"loader":""})}}]),n}(a.Component)),R=(n(82),function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(s.a)(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))).state={currentText:"",resultReturned:!0},t.done=function(){var e=t.props.callbackManager.callbackFuncs("SearchBar","done");O(t.state.currentText,1).then((function(n){0!=n.length?(t.setState({resultReturned:!0}),e.forEach((function(t){return t(n)}))):t.setState({resultReturned:!1})})).catch((function(e){t.setState({resultReturned:!1})}))},t.textInput=function(){return Object(r.jsxs)("div",{className:t.state.resultReturned?"search-bar":"search-bar red-alert",children:[Object(r.jsx)("input",{type:"text",className:"form-control",placeholder:"Search your topic!",onChange:function(e){t.setState({currentText:e.target.value})},onKeyDown:function(e){"Enter"===e.key&&t.done()}}),Object(r.jsx)("button",{className:"search-btn",type:"submit",onClick:function(e){t.done()},children:Object(r.jsx)("span",{className:"magnify"})})]})},t}return Object(l.a)(n,[{key:"render",value:function(){return Object(r.jsxs)("div",{className:"search-container",children:[this.textInput(),Object(r.jsx)(A,{})]})}}]),n}(a.Component)),W=function(){function t(){Object(s.a)(this,t),this.registry={}}return Object(l.a)(t,[{key:"registerObserver",value:function(t,e,n,r,a){var i="".concat(t,".").concat(e),o=this.registry[i];void 0==o&&(this.registry[i]=[],o=this.registry[i]);var c=o.filter((function(t){return t[0]===n&&t[1]===r}));0==c.length?o.push([n,r,a]):c[2]=a}},{key:"callbackFuncs",value:function(t,e){var n="".concat(t,".").concat(e),r=this.registry[n];return void 0==r?[]:r.map((function(t){return t[2]}))}}]),t}();n(83);function Y(t){var e=t.id,n=t.minVal,a=t.maxVal,i=t.defaultVal,o=t.callback,c=t.txt;return Object(r.jsxs)("div",{className:"slidercontainer",children:[Object(r.jsxs)("p",{children:[" ",c," "]}),Object(r.jsx)("input",{className:"slider",type:"range",id:e,min:n,max:a,defaultValue:i,onChange:o})]})}function T(){return Object(r.jsxs)("div",{children:[Object(r.jsx)("p",{children:" Changes applied will affect next graph interaction "}),Object(r.jsx)(Y,{id:"graphNeighCountSlider",minVal:2,maxVal:10,defaultVal:k.graphNeighbourCount,callback:function(t){k.graphNeighbourCount=parseInt(t.target.value)},txt:"Max number of neighbours per node."}),Object(r.jsx)(Y,{id:"graphGenerationCountSlider",minVal:2,maxVal:10,defaultVal:k.graphGenerationCount,callback:function(t){k.graphGenerationCount=parseInt(t.target.value)},txt:"Lifetime of nodes (1 lifetime = 1 click)"}),Object(r.jsx)(Y,{id:"nodeSizeMultiplierSlider",minVal:k.nodeSizeMin,maxVal:k.nodeSizeMax,defaultVal:k.nodeSizeMultiplier,callback:function(t){k.nodeSizeMultiplier=parseInt(t.target.value)},txt:"Node size multiplier"}),Object(r.jsx)(Y,{id:"nodeColorBrightnessSlider",minVal:k.nodeColorBrightnessMin,maxVal:k.nodeColorBrightnessMax,defaultVal:k.nodeColorBrightness,callback:function(t){k.nodeColorBrightness=parseInt(t.target.value)},txt:"Node brighness"}),Object(r.jsx)(Y,{id:"linkDistanceSlider",minVal:k.linkDistanceMin,maxVal:k.linkDistanceMax,defaultVal:k.linkDistanceMultiplier,callback:function(t){k.linkDistanceMultiplier=parseInt(t.target.value)},txt:"Link distance multiplier"})]})}var X=function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(){return Object(s.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(r.jsxs)("div",{className:"topnav background-2",children:[Object(r.jsx)("div",{className:"title",children:"WikiNodes (prototype)"}),Object(r.jsxs)("div",{className:"dropdown",children:[Object(r.jsxs)("button",{className:"dropbtn",children:["Customize",Object(r.jsx)("i",{className:"fa fa-caret-down"})]}),Object(r.jsx)("div",{className:"dropdown-content",children:Object(r.jsx)(T,{})})]}),Object(r.jsx)("a",{className:"git-link",href:"https://github.com/crunchypi/wikinodes-server",children:"Github source"})]})}}]),n}(a.Component),H=function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(s.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).state={callbackManager:new W},t}return Object(l.a)(n,[{key:"render",value:function(){return Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)(X,{}),Object(r.jsx)(R,{callbackManager:this.state.callbackManager}),Object(r.jsxs)("div",{className:"main-container",children:[Object(r.jsx)("div",{className:"graph-box",children:Object(r.jsx)(E,{callbackManager:this.state.callbackManager})}),Object(r.jsx)(L,{callbackManager:this.state.callbackManager})]}),Object(r.jsxs)("div",{className:"footer",children:[Object(r.jsx)("a",{className:"wiki-att",href:"https://wikimediafoundation.org/",children:"Attribution: Wikimedia Foundation"}),Object(r.jsxs)("span",{children:[Object(r.jsx)("br",{}),"Creative Commons Attribution-ShareAlike 3.0 Unported License (CC BY-SA) "]}),Object(r.jsxs)("span",{children:[Object(r.jsx)("br",{})," GNU Free Documentation License (GFDL)"]})]})]})}}]),n}(a.Component),U=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,85)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,i=e.getLCP,o=e.getTTFB;n(t),r(t),a(t),i(t),o(t)}))};c.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(H,{})}),document.getElementById("root")),U()}},[[84,1,2]]]);
//# sourceMappingURL=main.cae39b0d.chunk.js.map